<!-- Bootstrap RTL + Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

<style>
    /* زر أيقونة دائري */
    .icon-btn {
        --size: 36px;
        width: var(--size);
        height: var(--size);
        border-radius: 50%;
        border: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        cursor: pointer;
        transition: transform .2s ease,box-shadow .2s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,.15);
        color: #fff;
    }

    .icon-add {
        background: #28c76f;
    }
    /* أخضر */
    .icon-del {
        background: #ea5455;
    }
    /* أحمر */

    .icon-btn:hover {
        transform: scale(1.12) rotate(5deg);
        box-shadow: 0 4px 8px rgba(0,0,0,.25);
    }

    .icon-btn:active {
        transform: scale(.95);
    }

    .icon-btn i {
        pointer-events: none;
    }
</style>

<div class="mt-5">
    <div id="personal-info" class="shadow p-3">
        <span class="bg-color d-inline-block px-2 mb-2">إضافة مستند جديد مدخل</span>

        <!-- معلومات المستند -->
        <div class="row">
            <div class="col-sm-12 col-md-3 mt-3">
                <label class="form-label">رقم المستند</label>
                <input class="form-control" placeholder="أدخل رقم مستند" required />
            </div>
            <div class="col-sm-12 col-md-3 mt-3">
                <label class="form-label">تاريخ المستند</label>
                <input class="form-control" type="date" required />
            </div>
        </div>

        <hr>
        <h3 class="text-center my-3">إضافة مدخلات</h3>

        <!-- جدول المواد -->
        <table class="table table-striped align-middle text-center">
            <thead>
                <tr>
                    <th>#</th>
                    <th>اسم المادة</th>
                    <th>مصدر المادة</th>
                    <th>الوحدة</th>
                    <th>العدد</th>
                    <th>الثمن</th>
                    <th>السعر الإجمالي</th>
                    <th>تاريخ الإدخال</th>
                    <th>سنة التجهيز</th>
                    <th>التفاصيل</th>
                    <td class="text-center">
                        <button class="icon-btn icon-add" title="إضافة صف"><i class="bi bi-plus-lg"></i></button>
                    </td>
                </tr>
            </thead>

            <tbody id="subjectsBody">
                <!-- الصفّ الأوّل (قالب) بلا زرّ حذف -->
                <tr class="template-row">
                    <td class="row-index"></td>
                    <td>
                        <select name="subjectName" class="form-select" required>
                            <option value="" selected disabled>اختر اسم المادة…</option>
                            <option value="arabic">اللغة العربية</option>
                            <option value="english">اللغة الإنجليزية</option>
                            <option value="math">الرياضيات</option>
                            <option value="science">العلوم</option>
                            <option value="history">التاريخ</option>
                        </select>
                    </td>
                    <td><input type="text" name="source" class="form-control" placeholder="مصدر المادة" required></td>
                    <td>
                        <select name="unit" class="form-select" required>
                            <option value="" selected disabled>اختر الوحدة…</option>
                            <option value="kg">كغم</option>
                            <option value="ltr">لتر</option>
                            <option value="piece">قطعة</option>
                        </select>
                    </td>
                    <td><input type="number" name="quantity" class="form-control" min="1" placeholder="0"></td>
                    <td><input type="number" name="price" class="form-control" min="0" step="0.01" placeholder="0.00"></td>
                    <td><input type="number" name="totalPrice" class="form-control" min="0" step="0.01" placeholder="0.00"></td>
                    <td><input type="date" name="entryDate" class="form-control"></td>
                    <td>
                        <select name="supplyYear" class="form-select"><option selected disabled>اختر السنة…</option></select>
                    </td>
                    <td><textarea name="details" class="form-control" rows="1" placeholder="تفاصيل إضافية…"></textarea></td>
                    <td></td> <!-- خلية فارغة للحذف -->
                </tr>
            </tbody>
        </table>

        <div class="col-sm-12 mt-2">
            <input type="submit" class="form-control color-btn" value="حفظ" />
        </div>
    </div>
</div>

<script>
    /* ––– إعدادات عامة ––– */
    const body   = document.getElementById('subjectsBody');
    const addBtn = document.querySelector('.icon-add');

    /* توليد قائمة السنوات */
    function fillYears(select){
      const current=new Date().getFullYear();
      for(let y=current;y>=current-20;y--){
        const opt=document.createElement('option');
        opt.value=y;opt.textContent=y;
        select.appendChild(opt);
      }
    }

    /* إعادة الترقيم */
    function refreshIndices(){
      body.querySelectorAll('tr').forEach((tr,i)=>{
        tr.querySelector('.row-index').textContent=i+1;
      });
    }

    /* إضافة صف جديد */
    function addRow(){
      const template=body.querySelector('.template-row');
      const clone   =template.cloneNode(true);

      /* تفريغ القيم */
      clone.querySelectorAll('input,select,textarea').forEach(el=>el.value='');

      /* سنوات التجهيز */
      fillYears(clone.querySelector('select[name="supplyYear"]'));

      /* زر الحذف */
      clone.lastElementChild.innerHTML=
        `<button class="icon-btn icon-del" title="حذف الصف"><i class="bi bi-x-lg"></i></button>`;

      body.appendChild(clone);
      refreshIndices();
    }

    /* أحداث */
    addBtn.addEventListener('click',addRow);

    /* تفويض الحذف */
    body.addEventListener('click',e=>{
      const delBtn=e.target.closest('.icon-del');
      if(delBtn){
        delBtn.closest('tr').remove();
        refreshIndices();
      }
    });

    /* تهيئة الصفّ الأوّل */
    fillYears(document.querySelector('select[name="supplyYear"]'));
    refreshIndices();
</script>
