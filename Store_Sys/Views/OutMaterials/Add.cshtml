@model Store_Sys.Models.ViewModels.OutMaterialsViewModel

@{
    ViewData["Title"] = "إضافة مخرجات";
}

<div id="personal-info" class="shadow mt-3">
    <span class="bg-color">إضافة مخرجات</span>

    <form asp-action="Create" method="post">
        @Html.AntiForgeryToken()

        <div class="row">

            <!-- اسم المادة -->
            <div class="col-md-4 mt-3">
                <label asp-for="OutMaterial.MaterialId"></label>
                <select asp-for="OutMaterial.MaterialId" class="form-control" asp-items="ViewBag.MaterialsList">
                    <option value="">اختر اسم المادة</option>
                </select>
                <span asp-validation-for="OutMaterial.MaterialId" class="text-danger"></span>
            </div>

            <!-- العدد -->
            <div class="col-md-4 mt-3">
                <label asp-for="OutMaterial.Quantity"></label>
                <input asp-for="OutMaterial.Quantity" class="form-control" placeholder="العدد" />
                <span asp-validation-for="OutMaterial.Quantity" class="text-danger"></span>
            </div>

            <!-- نوع الإخراج -->
            <div class="col-md-4 mt-3">
                <label asp-for="OutMaterial.OutputType"></label>
                <select asp-for="OutMaterial.OutputType" class="form-control" asp-items="ViewBag.OutputTypes" id="OutputTypeDropdown" onchange="toggleOutputOptions()">
                    <option value="">اختر نوع الإخراج</option>
                </select>
                <span asp-validation-for="OutMaterial.OutputType" class="text-danger"></span>
            </div>

            <!-- الشخص -->
            <div class="col-md-4 mt-3 d-none" id="person-dropdown">
                <label asp-for="OutMaterial.PersonId"></label>
                <select asp-for="OutMaterial.PersonId" class="form-control" asp-items="ViewBag.PersonsList">
                    <option>اختر الشخص</option>
                </select>
            </div>

            <!-- القسم -->
            <div class="col-md-4 mt-3 d-none" id="department-dropdown">
                <label asp-for="OutMaterial.DepartmentId"></label>
                <select asp-for="OutMaterial.DepartmentId" class="form-control" asp-items="ViewBag.DepartmentsList">
                    <option value="">اختر القسم</option>
                </select>
            </div>

            <!-- مصدر المادة -->
            <div class="col-md-4 mt-3">
                <label asp-for="OutMaterial.Source"></label>
                <input asp-for="OutMaterial.Source" class="form-control" placeholder="مصدر المادة" />
                <span asp-validation-for="OutMaterial.Source" class="text-danger"></span>
            </div>
            <!-- الثمن -->
            <div class="col-sm-12 col-md-4 mt-3">
                <label class="form-label">الثمن</label>
                <input type="text" class="form-control" placeholder="" required>
                <div class="invalid-feedback">يُرجى إدخال الثمن.</div>
            </div>

            <!-- الوحدة -->
            <div class="col-sm-12 col-md-4 mt-3">
                <label class="form-label">الوحدة</label>
                <select class="form-select" required>
                    <option value="" selected disabled>اختر الوحدة</option>
                    <option value="kg">كيلوجرام</option>
                    <option value="l">لتر</option>
                    <option value="pc">قطعة</option>
                    <!-- أضف وحدات أخرى حسب الحاجة -->
                </select>
                <div class="invalid-feedback">يُرجى اختيار الوحدة.</div>
            </div>

            <!-- السعر -->
            <div class="col-sm-12 col-md-4 mt-3">
                <label class="form-label">السعر</label>
                <input type="text" class="form-control" placeholder=" " required>
                <div class="invalid-feedback">يُرجى إدخال السعر.</div>
            </div>
            <!-- رقم المستند -->
            <div class="col-md-4 mt-3">
                <label asp-for="OutMaterial.DocumentNumber"></label>
                <input asp-for="OutMaterial.DocumentNumber" class="form-control" placeholder="رقم المستند" />
                <span asp-validation-for="OutMaterial.DocumentNumber" class="text-danger"></span>
            </div>
            <!-- التفاصيل -->
            <div class="col-12">
                <label class="form-label">التفاصيل</label>
                <textarea class="form-control" rows="3" placeholder="أضف أي ملاحظات إضافية"></textarea>
            </div>
        </div>
        <div class="col-sm-12 mt-3">
            <input type="submit" class="form-control color-btn" value="حفظ" />
        </div>

        @if (!ViewData.ModelState.IsValid)
        {
            <div class="alert alert-danger">
                <ul>
                    @foreach (var modelState in ViewData.ModelState.Values)
                    {
                        foreach (var error in modelState.Errors)
                        {
                            <li>@error.ErrorMessage</li>
                        }
                    }
                </ul>
            </div>
        }
    </form>
</div>

<script>
        function toggleOutputOptions() {
        const type = document.getElementById("OutputTypeDropdown").value; // استخدام الـ id الصحيح هنا
        const personDiv = document.getElementById("person-dropdown");
        const deptDiv = document.getElementById("department-dropdown");

        // إظهار/إخفاء القيم بناءً على نوع الإخراج
        if (type === "1") { // إخراج شخصي
            personDiv.classList.remove("d-none");
            deptDiv.classList.add("d-none");
        } else if (type === "2") { // إخراج قسم
            deptDiv.classList.remove("d-none");
            personDiv.classList.add("d-none");
        } else {
            personDiv.classList.add("d-none");
            deptDiv.classList.add("d-none");
        }
    }

    // تأكد من عرض الخيار الصحيح عند الرجوع للنموذج بعد فشل التحقق
    document.addEventListener("DOMContentLoaded", function () {
        toggleOutputOptions(); // تأكد من تطبيق المنطق عند تحميل الصفحة
    });
</script>

