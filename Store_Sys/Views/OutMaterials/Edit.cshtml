@model Store_Sys.Models.ViewModels.OutMaterialsViewModel

@{
    ViewData["Title"] = "تعديل مخرجات";
}

<form asp-action="Edit" method="post">
    <input type="hidden" asp-for="OutMaterial.Id" />

    <div id="personal-info" class="shadow mt-3">
        <span class="bg-color">تعديل مخرجات</span>
        <div class="row">
            <!-- اسم المادة -->
            <div class="col-sm-12 col-md-4 mt-3">
                <label asp-for="OutMaterial.MaterialId"></label>
                <select asp-for="OutMaterial.MaterialId" class="form-control" asp-items="ViewBag.MaterialsList">
                    <option disabled selected>اختر اسم المادة</option>
                </select>
                <span asp-validation-for="OutMaterial.MaterialId" class="text-danger"></span>
            </div>

            <!-- العدد -->
            <div class="col-sm-12 col-md-4 mt-3">
                <label asp-for="OutMaterial.Quantity"></label>
                <input asp-for="OutMaterial.Quantity" class="form-control" placeholder="العدد" />
                <span asp-validation-for="OutMaterial.Quantity" class="text-danger"></span>
            </div>

            <!-- نوع الإخراج -->
            <div class="col-sm-12 col-md-4 mt-3">
                <label asp-for="OutMaterial.OutputType"></label>
                <select asp-for="OutMaterial.OutputType" class="form-control" asp-items="ViewBag.OutputTypes" onchange="toggleOutputOptions()">
                    <option disabled selected>اختر نوع الإخراج</option>
                </select>
                <span asp-validation-for="OutMaterial.OutputType" class="text-danger"></span>
            </div>

            <!-- الشخص -->
            <div class="col-sm-12 col-md-4 mt-3 @(Model.OutMaterial.OutputType == OutputType.Personal ? "" : "d-none")" id="person-dropdown">
                <label asp-for="OutMaterial.PersonId"></label>
                <select asp-for="OutMaterial.PersonId" class="form-control" asp-items="ViewBag.PersonsList">
                    <option disabled selected>اختر الشخص</option>
                </select>
                <span asp-validation-for="OutMaterial.PersonId" class="text-danger"></span>
            </div>

            <!-- القسم -->
            <div class="col-sm-12 col-md-4 mt-3 @(Model.OutMaterial.OutputType == OutputType.Department ? "" : "d-none")" id="department-dropdown">
                <label asp-for="OutMaterial.DepartmentId"></label>
                <select asp-for="OutMaterial.DepartmentId" class="form-control" asp-items="ViewBag.DepartmentsList">
                    <option disabled selected>اختر القسم</option>
                </select>
                <span asp-validation-for="OutMaterial.DepartmentId" class="text-danger"></span>
            </div>

            <!-- المصدر -->
            <div class="col-sm-12 col-md-4 mt-3">
                <label asp-for="OutMaterial.Source"></label>
                <input asp-for="OutMaterial.Source" class="form-control" placeholder="اسم المصدر" />
                <span asp-validation-for="OutMaterial.Source" class="text-danger"></span>
            </div>
            <!-- الثمن -->
            <div class="col-sm-12 col-md-4 mt-3">
                <label class="form-label">الثمن</label>
                <input type="text" class="form-control" placeholder="" required>
                <div class="invalid-feedback">يُرجى إدخال الثمن.</div>
            </div>

            <!-- الوحدة -->
            <div class="col-sm-12 col-md-4 mt-3">
                <label class="form-label">الوحدة</label>
                <select class="form-select" required>
                    <option value="" selected disabled>اختر الوحدة</option>
                    <option value="kg">كيلوجرام</option>
                    <option value="l">لتر</option>
                    <option value="pc">قطعة</option>
                    <!-- أضف وحدات أخرى حسب الحاجة -->
                </select>
                <div class="invalid-feedback">يُرجى اختيار الوحدة.</div>
            </div>

            <!-- السعر -->
            <div class="col-sm-12 col-md-4 mt-3">
                <label class="form-label">السعر</label>
                <input type="text" class="form-control" placeholder=" " required>
                <div class="invalid-feedback">يُرجى إدخال السعر.</div>
            </div>
            <!-- رقم المستند -->
            <div class="col-sm-12 col-md-4 mt-3">
                <label asp-for="OutMaterial.DocumentNumber"></label>
                <input asp-for="OutMaterial.DocumentNumber" class="form-control" placeholder="رقم المستند" />
                <span asp-validation-for="OutMaterial.DocumentNumber" class="text-danger"></span>
            </div>
        </div>
        <!-- التفاصيل -->
        <div class="col-12">
            <label class="form-label">التفاصيل</label>
            <textarea class="form-control" rows="3" placeholder="أضف أي ملاحظات إضافية"></textarea>
        </div>
        <div class="col-sm-12 mt-3">
            <input type="submit" class="form-control color-btn" value="حفظ" />
        </div>
    </div>
</form>

@section Scripts {
    <script>
        function toggleOutputOptions() {
            const type = document.getElementById("OutMaterial_OutputType").value;
            const personDiv = document.getElementById("person-dropdown");
            const deptDiv = document.getElementById("department-dropdown");

            if (type === "1") { // Personal
                personDiv.classList.remove("d-none");
                deptDiv.classList.add("d-none");
            } else if (type === "2") { // Department
                deptDiv.classList.remove("d-none");
                personDiv.classList.add("d-none");
            } else {
                personDiv.classList.add("d-none");
                deptDiv.classList.add("d-none");
            }
        }

        // لتفعيل الخيارات حسب القيمة الحالية عند تحميل الصفحة
        document.addEventListener("DOMContentLoaded", toggleOutputOptions);
    </script>
}

